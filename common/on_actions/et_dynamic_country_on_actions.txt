# On-actions to evaluate dynamic country cede candidacy monthly per state

# Runs on each state monthly. If the state's candidate predicate is true for its owner,
# mark it with dynamic_state_cede. Otherwise remove the variable.
# Monthly per-state action to evaluate dynamic country cede candidacy and mark/clear the state

# Runs once per month on states. If the state's candidate predicate is true for its owner,
# the state gains the `dynamic_state_cede` variable; otherwise the variable is removed.
on_monthly_pulse_state = {
    on_action = {
        dynamic_country_state_variable = yes
    }

dynamic_country_state_variable = {
    effect = {
        if = {
            limit = {
                # Require AI improvements enabled and not at war for the owner
                owner = { has_game_rule = ai_improvement_enabled is_at_war = no }
                is_capital = no

                OR = {
                    NOT = { has_modifier = recent_state_owner_change }
                    market_access < 0.01
                }

                OR = {
                    AND = {
                        is_homeland_of_country_cultures = owner
                        OR = { turmoil > 0.70 market_access < 0.01 }
                    }

                    AND = {
                        NOT = { is_homeland_of_country_cultures = owner }
                        OR = { turmoil > 0.50 market_access < 0.15 }
                    }
                }
            }

            # If matches candidate predicate, run centralized mark effect
            et_mark_state_for_dyn_country_effect = yes
        }
        else = {
            et_clear_state_dyn_country_effect = yes
        }
    }
}
}