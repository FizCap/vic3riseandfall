on_monthly_pulse_country = {
	on_actions = {
		et_investment_pool_monthly
	}
}

et_investment_pool_monthly = {
	effect = {
		if = {
			limit = {
				NOT = { has_journal_entry = et_treasury_investment_pool_transfer }
				OR = {
					investment_pool > 0
					gold_reserves > 0
				}
			}
			add_journal_entry = { type = et_treasury_investment_pool_transfer }
		}

		# Unique auto-transfer logic: keep 20% of gold reserves, move rest to investment pool
		if = {
			limit = {
				has_variable = et_auto_transfer_var
				gold_reserves > 0
			}
			# Calculate minimum reserve to keep (20%)
			set_variable = {
				name = et_reserve_floor
				value = gold_reserves_limit
			}
			change_variable = {
				name = et_reserve_floor
				multiply = 0.2
			}

			# If above reserve, move surplus
			if = {
				limit = {
					gold_reserves > var:et_reserve_floor
				}
				set_variable = {
					name = et_surplus_gold
					value = gold_reserves
				}
				change_variable = {
					name = et_surplus_gold
					subtract = var:et_reserve_floor
				}
				# Move surplus to investment pool and subtract from treasury
				add_investment_pool = var:et_surplus_gold
				change_variable = {
					name = et_surplus_gold
					multiply = -1
				}
				add_treasury = var:et_surplus_gold
			}
			# Clean up variables
			remove_variable = et_reserve_floor
			remove_variable = et_surplus_gold
		}
	}
}